<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shotABC</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            cursor: default;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.8);
            z-index: 100;
        }
        
        #start-screen h1 {
            font-size: 48px;
            margin-bottom: 30px;
            color: #ffeb3b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        #startScreen .version {
            font-size: 14px;
            color: #666;
            position: absolute;
            bottom: 30px;
        }      
        
        #rules {
            max-width: 600px;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 30px;
            padding: 0 20px;
        }
        
        #rules p {
            margin: 10px 0;
            font-size: 18px;
        }
        
        #start-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        #start-button:hover {
            background: #45a049;
        }
        
        .letter {
            position: absolute;
            font-size: 60px;
            font-weight: bold;
            user-select: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            transition: transform 0.1s ease;
        }
        
        .letter.hit {
            opacity: 0.3;
            transform: scale(0.8);
        }
        
        .explosion {
            position: absolute;
            width: 40px; /* ç¼©å°50% */
            height: 40px; /* ç¼©å°50% */
            background-image: url('right.bmp');
            background-size: contain;
            background-repeat: no-repeat;
            pointer-events: none;
            opacity: 0;
            animation: explode 1s forwards;
        }
        
        @keyframes explode {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 0.7; transform: scale(1); }
        }
        
        #status {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 18px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        
        #results {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
        }
        
        #results h2 {
            margin: 0 0 20px 0;
            color: #ffeb3b;
        }
        
        #results p {
            margin: 10px 0;
            font-size: 20px;
        }
        
        #audio-warning {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }
        
        #audio-toggle, #reset-best {
            position: absolute;
            top: 20px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            z-index: 10;
            transition: background 0.3s;
        }
        
        #audio-toggle {
            left: 20px;
        }
        
        #reset-best {
            left: 120px;
        }
        
        #audio-toggle:hover, #reset-best:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="start-screen">
            <h1>shotABC</h1>
            <div id="rules">
                <p><strong>æ¸¸æˆè§„åˆ™ï¼š</strong></p>
                <p>â€¢ å±å¹•ä¸Šä¼šéšæœºå‡ºç°5ä¸ªå­—æ¯</p>
                <p>â€¢ è¯·è¿…é€ŸæŒ‰é”®å‡»ä¸­</p>
            </div>
            <button id="start-button">æŒ‰ç©ºæ ¼é”®æˆ–ç‚¹å‡»å¼€å§‹</button>
            <br><br>
            <div class="version">shotABC Web Version A1.0</div>
        </div>
        
        <div id="audio-toggle">ğŸ”‡ éŸ³æ•ˆ: å…³</div>
        <div id="reset-best">ğŸ—‘ï¸ é‡ç½®æœ€ä½³</div>
        <div id="status"></div>
        <div id="instructions"></div>
        <div id="results">
            <h2>æ¸¸æˆç»“æŸï¼</h2>
            <p id="current-time">å½“å‰ç”¨æ—¶: --</p>
            <p id="best-time">å†å²æœ€ä½³: --</p>
            <p id="result-message"></p>
            <p>æŒ‰ç©ºæ ¼é”®å¼€å§‹ä¸‹ä¸€å±€</p>
        </div>
        <div id="audio-warning">
            <p>âš ï¸ éŸ³é¢‘åŠŸèƒ½å—é™</p>
            <p>è¯·å…ˆç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®å¯ç”¨éŸ³æ•ˆ</p>
        </div>
    </div>

    <script>
        // ä½¿ç”¨ Audio å¯¹è±¡è€Œä¸æ˜¯ Web Audio APIï¼ˆæ›´ç®€å•ï¼Œå…¼å®¹æ€§æ›´å¥½ï¼‰
        const audioElements = {};
        let bestTime = localStorage.getItem('shotABC_bestTime') || null;
        let audioEnabled = false;
        let soundOn = false; // é»˜è®¤å…³é—­
        
        // æ¸¸æˆçŠ¶æ€
        let gameState = 'waiting'; // waiting, playing, finished
        let letters = [];
        let pressedCount = 0;
        let correctCount = 0;
        let startTime = 0;
        let letterElements = [];
        let explosionElements = [];
        
        // é¢„åŠ è½½æ‰€æœ‰éŸ³æ•ˆ
        function preloadAudio() {
            const soundFiles = [
                'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 
                'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',
                'Sbao', 'Swrong', 'Sother'
            ];
            
            for (const file of soundFiles) {
                try {
                    const audio = new Audio(`${file}.wav`);
                    audio.preload = 'auto';
                    audio.load();
                    audioElements[file] = audio;
                } catch (error) {
                    console.warn(`Failed to load sound: ${file}`, error);
                }
            }
        }
        
        // æ’­æ”¾éŸ³æ•ˆï¼ˆå¤„ç†æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾ç­–ç•¥ï¼‰
        function playSound(soundName) {
            if (!soundOn || !audioElements[soundName]) {
                return;
            }
            
            try {
                // å…‹éš†éŸ³é¢‘å…ƒç´ ä»¥æ”¯æŒåŒæ—¶æ’­æ”¾å¤šä¸ªéŸ³æ•ˆ
                const audio = audioElements[soundName].cloneNode();
                audio.volume = 0.7;
                audio.play().catch(error => {
                    // å¦‚æœæ’­æ”¾è¢«é˜»æ­¢ï¼Œæ˜¾ç¤ºæç¤º
                    if (!audioEnabled) {
                        document.getElementById('audio-warning').style.display = 'block';
                    }
                });
            } catch (error) {
                console.warn('Failed to play sound:', error);
            }
        }
        
        // å¯ç”¨éŸ³é¢‘ï¼ˆç”¨æˆ·äº¤äº’åï¼‰
        function enableAudio() {
            if (audioEnabled) return;
            audioEnabled = true;
            document.getElementById('audio-warning').style.display = 'none';
            
            // æµ‹è¯•æ’­æ”¾ä¸€ä¸ªéŸ³æ•ˆ
            try {
                const testAudio = new Audio('Sother.wav');
                testAudio.volume = 0.1;
                testAudio.play().catch(() => {});
            } catch (e) {}
        }
        
        // åˆ‡æ¢éŸ³æ•ˆå¼€å…³
        function toggleSound() {
            soundOn = !soundOn;
            const toggleBtn = document.getElementById('audio-toggle');
            toggleBtn.textContent = soundOn ? 'ğŸ”Š éŸ³æ•ˆ: å¼€' : 'ğŸ”‡ éŸ³æ•ˆ: å…³';
            toggleBtn.style.background = soundOn ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.2)';
        }
        
        // é‡ç½®æœ€ä½³æˆç»©
        function resetBestTime() {
            bestTime = null;
            localStorage.removeItem('shotABC_bestTime');
            
            // æ˜¾ç¤ºéé˜»å¡æç¤º
            const notification = document.createElement('div');
            notification.textContent = 'å·²é‡ç½®æœ€ä½³æˆç»©ï¼';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.8);
                color: #4CAF50;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 1000;
                font-size: 16px;
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            document.body.appendChild(notification);
            
            // æ·¡å…¥æ˜¾ç¤º
            setTimeout(() => {
                notification.style.opacity = '1';
            }, 100);
            
            // 2ç§’åæ·¡å‡ºæ¶ˆå¤±
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 2000);
        }
        
        function createLetters() {
            const container = document.getElementById('game-container');
            letters = [];
            letterElements = [];
            explosionElements = [];
            
            // ç”Ÿæˆ5ä¸ªéšæœºå­—æ¯
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            for (let i = 0; i < 5; i++) {
                const char = chars[Math.floor(Math.random() * chars.length)];
                letters.push(char);
                
                // éšæœºä½ç½®
                const x = Math.random() * (window.innerWidth - 100) + 50;
                const y = Math.random() * (window.innerHeight - 200) + 100;
                
                // åˆ›å»ºå­—æ¯å…ƒç´ 
                const letterEl = document.createElement('div');
                letterEl.className = 'letter';
                letterEl.textContent = char;
                letterEl.style.left = x + 'px';
                letterEl.style.top = y + 'px';
                letterEl.dataset.index = i;
                letterEl.dataset.hit = 'false';
                
                container.appendChild(letterEl);
                letterElements.push(letterEl);
            }
        }
        
        function showExplosion(x, y) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.left = (x - 20) + 'px'; // è°ƒæ•´ä½ç½®é€‚åº”ç¼©å°çš„è´´å›¾
            explosion.style.top = (y - 20) + 'px';
            document.getElementById('game-container').appendChild(explosion);
            explosionElements.push(explosion);
            
            // ä¿æŒçˆ†ç‚¸æ•ˆæœ
            setTimeout(() => {
                explosion.style.opacity = '0.3';
            }, 1000);
        }
        
        function startGame() {
            // éšè—å¼€å§‹ç•Œé¢
            document.getElementById('start-screen').style.display = 'none';
            
            // æ¸…ç†ä¹‹å‰çš„å…ƒç´ 
            letterElements.forEach(el => el.remove());
            explosionElements.forEach(el => el.remove());
            document.getElementById('results').style.display = 'none';
            
            gameState = 'playing';
            pressedCount = 0;
            correctCount = 0;
            document.getElementById('status').textContent = '';
            document.getElementById('instructions').textContent = '';
            
            createLetters();
            startTime = Date.now();
            
            // å¯ç”¨éŸ³é¢‘
            enableAudio();
        }
        
        function endGame() {
            gameState = 'finished';
            const endTime = Date.now();
            const timeTaken = ((endTime - startTime) / 1000).toFixed(2);
            
            // æ›´æ–°æœ€ä½³æˆç»©ï¼ˆåªæœ‰å…¨å¯¹æ‰è®°å½•ï¼‰
            if (correctCount === 5) {
                if (!bestTime || parseFloat(timeTaken) < parseFloat(bestTime)) {
                    bestTime = timeTaken;
                    localStorage.setItem('shotABC_bestTime', bestTime);
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('current-time').textContent = `å½“å‰ç”¨æ—¶: ${timeTaken}ç§’`;
            document.getElementById('best-time').textContent = bestTime ? `å†å²æœ€ä½³: ${bestTime}ç§’` : 'å†å²æœ€ä½³: --';
            document.getElementById('result-message').textContent = 
                correctCount === 5 ? 'ğŸ‰ å…¨éƒ¨æ­£ç¡®ï¼' : `âŒ æ­£ç¡®: ${correctCount}/5`;
            
            document.getElementById('results').style.display = 'block';
            document.getElementById('instructions').textContent = 'æŒ‰ç©ºæ ¼é”®å¼€å§‹ä¸‹ä¸€å±€';
        }
        
        function handleKeyPress(event) {
            if (event.key === ' ') {
                event.preventDefault();
                enableAudio(); // ç¡®ä¿éŸ³é¢‘å¯ç”¨
                
                if (gameState === 'waiting' || gameState === 'finished') {
                    startGame();
                }
                return;
            }
            
            if (gameState !== 'playing') {
                return;
            }
            
            // åªå¤„ç†å­—æ¯é”®
            if (event.key.length === 1 && /[a-zA-Z]/.test(event.key)) {
                pressedCount++;
                const pressedKey = event.key.toUpperCase();
                
                let found = false;
                for (let i = 0; i < letters.length; i++) {
                    if (letters[i] === pressedKey && letterElements[i].dataset.hit === 'false') {
                        // æŒ‰å¯¹äº†
                        correctCount++;
                        letterElements[i].dataset.hit = 'true';
                        letterElements[i].classList.add('hit');
                        
                        // æ’­æ”¾å¯¹åº”å­—æ¯éŸ³æ•ˆ
                        playSound(pressedKey.toLowerCase());
                        
                        // æ˜¾ç¤ºçˆ†ç‚¸æ•ˆæœ
                        const rect = letterElements[i].getBoundingClientRect();
                        showExplosion(rect.left + rect.width/2, rect.top + rect.height/2);
                        
                        found = true;
                        break;
                    }
                }
                
                if (!found) {
                    // æŒ‰é”™äº†æˆ–é‡å¤æŒ‰é”®
                    playSound('Swrong');
                }
                
                // æ£€æŸ¥æ˜¯å¦æŒ‰äº†5æ¬¡
                if (pressedCount >= 5) {
                    endGame();
                }
            } else {
                // éå­—æ¯é”®
                if (gameState === 'playing') {
                    playSound('Sother');
                }
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            preloadAudio();
            
            // è®¾ç½®éŸ³æ•ˆå¼€å…³
            document.getElementById('audio-toggle').addEventListener('click', toggleSound);
            
            // è®¾ç½®é‡ç½®æŒ‰é’®
            document.getElementById('reset-best').addEventListener('click', resetBestTime);
            
            // å¼€å§‹æŒ‰é’®
            document.getElementById('start-button').addEventListener('click', () => {
                if (gameState === 'waiting') {
                    startGame();
                }
            });
            
            document.addEventListener('keydown', handleKeyPress);
            
            // å¤„ç†ç”¨æˆ·ç‚¹å‡»ä»¥å¯ç”¨éŸ³é¢‘
            document.addEventListener('click', enableAudio);
            document.addEventListener('touchstart', enableAudio);
            
            // é˜²æ­¢é¡µé¢æ»šåŠ¨
            document.addEventListener('keydown', (e) => {
                if ([' ', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                }
            });
        });
        
        // å¤„ç†çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', () => {
            if (gameState === 'playing') {
                // ç®€åŒ–å¤„ç†
            }
        });
    </script>
</body>
</html>
